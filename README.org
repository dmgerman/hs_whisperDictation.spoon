#+title: WhisperDictation - Voice to Text for Mac
#+author: dmg
#+date: 2025

Speak and see your words appear as text. Works offline, supports 100+ languages, and puts privacy first.

* What Does It Do?

1. *Press a hotkey* to start recording
2. *Speak* your text
3. *Press the hotkey again* to stop
4. *Get your text* - either pasted automatically or copied to clipboard

That's it!

* Quick Start

** 1. Choose Your Setup

Pick based on what you value most:

*** ðŸš€ *Fast & Simple* (Cloud API - Recommended for Beginners)

#+begin_src lua
-- Add to ~/.hammerspoon/init.lua
hs.loadSpoon("hs_whisperDictation")

-- Configure
wd.transcriptionMethod = "groq"  -- Fast cloud API
wd.groqApiKey = "your-api-key-here"  -- Get free key from groq.com
wd.recordingBackend = "sox"  -- Simple recording

-- Set your hotkey (Ctrl+Cmd+D)
wd:bindHotKeys({
  toggle = {{"ctrl", "cmd"}, "d"}
})

wd:start()
#+end_src

*Install:* =brew install sox=

*Pros:* Super fast, easy setup, always works

*Cons:* Requires internet, sends audio to Groq (privacy trade-off)

*** ðŸ”’ *Private & Offline* (Apple Silicon Macs Only)

#+begin_src lua
hs.loadSpoon("hs_whisperDictation")

wd.transcriptionMethod = "whisperkit"  -- Apple optimized
wd.recordingBackend = "sox"

wd:bindHotKeys({
  toggle = {{"ctrl", "cmd"}, "d"}
})

wd:start()
#+end_src

*Install:* =brew install sox whisperkit-cli=

*Pros:* 100% private, offline, Apple Silicon optimized

*Cons:* Slower than cloud, requires Mac with M1/M2/M3 chip

*** âš¡ *Pro Setup* (Real-time, Smart Chunking)

#+begin_src lua
hs.loadSpoon("hs_whisperDictation")

wd.recordingBackend = "pythonstream"  -- Smart recording
wd.transcriptionMethod = "groq"  -- Fast transcription

wd:bindHotKeys({
  toggle = {{"ctrl", "cmd"}, "d"}
})

wd:start()
#+end_src

*Install:*

#+begin_src bash
brew install sox  # Fallback
pip install sounddevice scipy torch  # Python backend
#+end_src

*Pros:* Real-time chunk transcription, intelligent silence detection

*Cons:* More setup required

** 2. Set Your Language

#+begin_src lua
wd.languages = {"en"}  -- English only
-- Or multiple:
wd.languages = {"en", "ja", "es", "fr"}  -- English, Japanese, Spanish, French
#+end_src

Press *Ctrl+Cmd+L* to switch languages while running.

** 3. Test It

1. Press *Ctrl+Cmd+D* (or your chosen hotkey)
2. See the menubar icon change (ðŸŽ™ï¸ recording indicator)
3. Speak: "Hello world, this is a test"
4. Press *Ctrl+Cmd+D* again
5. Your text appears in the clipboard - paste it anywhere!

* Common Use Cases

** Copy to Clipboard

Default behavior - transcribed text goes to clipboard.

#+begin_src lua
wd:bindHotKeys({
  toggle = {{"ctrl", "cmd"}, "d"}
})
#+end_src

*Usage:* Press hotkey â†’ Speak â†’ Press hotkey â†’ Paste (Cmd+V)

** Auto-Paste (Beta)

Text automatically pastes if you don't type/click during recording.

#+begin_src lua
wd.monitorUserActivity = true

wd:bindHotKeys({
  toggle = {{"ctrl", "cmd"}, "d"},      -- Copy mode
  togglePaste = {{"ctrl", "cmd"}, "p"}  -- Auto-paste mode
})
#+end_src

*Usage:* Press *Ctrl+Cmd+P* â†’ Speak â†’ Press *Ctrl+Cmd+P* â†’ Text auto-pastes!

*When it auto-pastes:*
- âœ… You stayed in the same app
- âœ… You didn't type anything
- âœ… You didn't click the mouse

*When it just copies to clipboard:*
- âš ï¸ You typed something
- âš ï¸ You clicked the mouse
- âš ï¸ You switched to a different app

** Multiple Languages

Switch on the fly:

#+begin_src lua
wd.languages = {"en", "ja", "es"}

wd:bindHotKeys({
  toggle = {{"ctrl", "cmd"}, "d"},
  nextLang = {{"ctrl", "cmd"}, "l"}  -- Switch language
})
#+end_src

*Usage:* Press *Ctrl+Cmd+L*, choose language, then record

* Transcription Methods Explained

** groq (Cloud API)

*What it is:* Sends audio to Groq's servers for transcription

*Speed:* âš¡âš¡âš¡ Very fast (1-2 seconds)

*Privacy:* Audio leaves your Mac

*Cost:* Free tier available

*Best for:* Speed and convenience

*Setup:*

#+begin_src lua
wd.transcriptionMethod = "groq"
wd.groqApiKey = "gsk_..."  -- Get from groq.com
#+end_src

** whisperkit (Apple Silicon)

*What it is:* Uses Apple's Neural Engine on your Mac

*Speed:* âš¡âš¡ Fast (3-5 seconds)

*Privacy:* 100% local, nothing leaves your Mac

*Cost:* Free

*Best for:* Privacy-conscious Mac users

*Setup:*

#+begin_src bash
brew install whisperkit-cli
#+end_src

#+begin_src lua
wd.transcriptionMethod = "whisperkit"
#+end_src

** whispercli (CPU/GPU)

*What it is:* Runs Whisper on your CPU/GPU

*Speed:* âš¡ Slower (10-30 seconds)

*Privacy:* 100% local

*Cost:* Free

*Best for:* Non-Apple Silicon Macs

*Setup:*

#+begin_src bash
brew install whisper-cli
# Download model
mkdir -p /usr/local/whisper
cd /usr/local/whisper
wget https://huggingface.co/ggerganov/whisper.cpp/resolve/main/ggml-large-v3.bin
#+end_src

#+begin_src lua
wd.transcriptionMethod = "whispercli"
wd.transcriptionMethods.whispercli.config.modelPath = "/usr/local/whisper/ggml-large-v3.bin"
#+end_src

** whisperserver (HTTP Server)

*What it is:* Local HTTP server (model stays loaded)

*Speed:* âš¡âš¡ Fast after first use

*Privacy:* 100% local

*Cost:* Free

*Best for:* Heavy users (model stays in RAM)

*Setup:* See [[file:docs/SERVER_SETUP.md][Server Setup Guide]]

* Recording Backends Explained

** sox (Simple)

*What it is:* Records one file per session

*When to use:* Simple needs, fallback option

*Install:* =brew install sox=

#+begin_src lua
wd.recordingBackend = "sox"
#+end_src

** pythonstream (Smart)

*What it is:* Real-time recording with smart chunking

*Features:*
- Detects silence and creates chunks automatically
- Transcribes while you're still talking
- Faster overall for long recordings

*When to use:* Long dictations, want faster results

*Install:*

#+begin_src bash
pip install sounddevice scipy torch
#+end_src

#+begin_src lua
wd.recordingBackend = "pythonstream"
#+end_src

* Configuration Reference

** Basic Settings

#+begin_src lua
-- Languages
wd.languages = {"en", "ja"}  -- Available languages
wd.currentLang = "en"         -- Default language

-- Directories
wd.tempDir = "/tmp/whisper_dict"  -- Where audio files are saved

-- Timeouts
wd.timeoutSeconds = 1800  -- Auto-stop after 30 minutes (nil = no limit)

-- UI
wd.showRecordingIndicator = true  -- Show red dot while recording
#+end_src

** Transcription Method Settings

#+begin_src lua
-- Groq
wd.groqApiKey = "gsk_..."
wd.groqModel = "whisper-large-v3"  -- or "whisper-large-v3-turbo"

-- WhisperKit
wd.transcriptionMethods.whisperkitcli.config.model = "large-v3"

-- Whisper CLI
wd.transcriptionMethods.whispercli.config.modelPath = "/path/to/model.bin"

-- Whisper Server
wd.serverConfig.port = 8080
wd.serverConfig.host = "127.0.0.1"
#+end_src

** Recording Backend Settings

#+begin_src lua
-- Python Stream
wd.pythonstreamConfig = {
  port = 12341,
  silenceThreshold = 2.0,   -- Seconds of silence before chunk split
  minChunkDuration = 3.0,   -- Minimum chunk length
  maxChunkDuration = 600.0, -- Maximum chunk length
}
#+end_src

** Auto-Paste Settings

#+begin_src lua
wd.monitorUserActivity = true  -- Enable activity monitoring
wd.autoPasteDelay = 0.1         -- Delay before pasting (seconds)
wd.pasteWithEmacsYank = false   -- Use Ctrl-Y for Emacs (if true)
#+end_src

* Troubleshooting

** "No audio recorded"

*Fix:*
1. Check microphone permissions: System Settings â†’ Privacy & Security â†’ Microphone â†’ Enable Hammerspoon
2. Check microphone selection: System Settings â†’ Sound â†’ Input â†’ Choose your mic
3. Test recording: =sox -d test.wav= (speak for 5 seconds, then Ctrl+C), then =afplay test.wav=

** "Empty transcription"

*Fix:*
1. Verify audio file: =ls -lh /tmp/whisper_dict/*.wav= (should be >100KB)
2. Play recording: =afplay /tmp/whisper_dict/en-*.wav | tail -1=
3. If silent, check microphone in System Settings

** "Python stream server won't start"

*Fix:*

#+begin_src bash
# Check if port is in use
lsof -i :12341

# Kill zombie process if needed
lsof -ti:12341 | xargs kill -9

# Check Python dependencies
pip list | grep -E "sounddevice|torch|scipy"
#+end_src

** "Whisper command not found"

*Fix:*

#+begin_src bash
# For WhisperKit
brew install whisperkit-cli

# For Whisper CLI
brew install whisper-cli

# For sox
brew install sox
#+end_src

** Check what's happening

#+begin_src lua
-- In Hammerspoon console (Cmd+Opt+Ctrl+C)

-- Check current status
print(hs.inspect(wd:getStatus()))

-- List recent recordings
print(hs.execute("ls -lht /tmp/whisper_dict/*.wav | head -5"))

-- Play most recent
latest = hs.execute("ls -t /tmp/whisper_dict/*.wav | head -1"):gsub("\n", "")
hs.execute("afplay " .. latest)
#+end_src

* Advanced: Custom Callback

Instead of clipboard, do whatever you want with the text:

#+begin_src lua
wd:toggleTranscribe(function(text)
  -- Your custom code here
  print("You said: " .. text)

  -- Examples:
  -- Send to app
  hs.urlevent.openURL("myapp://text?content=" .. hs.http.encodeForQuery(text))

  -- Save to file
  local f = io.open("/tmp/dictation.txt", "a")
  f:write(text .. "\n")
  f:close()

  -- Post to webhook
  hs.http.doRequest("https://myserver.com/api", "POST", text)
end)
#+end_src

* Recommended Configurations

** Best for Beginners

#+begin_src lua
wd.transcriptionMethod = "groq"
wd.groqApiKey = "your-key"
wd.recordingBackend = "sox"
#+end_src

** Best for Privacy

#+begin_src lua
wd.transcriptionMethod = "whisperkit"  -- Apple Silicon only
wd.recordingBackend = "sox"
#+end_src

** Best for Speed (Privacy Trade-off)

#+begin_src lua
wd.transcriptionMethod = "groq"
wd.recordingBackend = "pythonstream"
#+end_src

** Best for Heavy Users (Local, Fast)

#+begin_src lua
wd.transcriptionMethod = "whisperserver"
wd.recordingBackend = "pythonstream"
#+end_src

* Getting Help

1. Check this README
2. Check [[file:docs/TROUBLESHOOTING.md][Common Issues]]
3. Enable debug mode: =wd.logger:setLevel("DEBUG")= then check Hammerspoon Console
4. Open an issue with:
   - Your configuration
   - Output of =wd:getStatus()=
   - Relevant console logs

* Privacy & Security

*What stays on your Mac:*
- All configurations
- All recordings (in =/tmp/whisper_dict/=)
- When using local methods (whisperkit, whispercli, whisperserver)

*What leaves your Mac:*
- Audio files when using Groq (sent to Groq's servers)
- Nothing else - no telemetry, no tracking

*To maximize privacy:*
- Use =whisperkit= or =whispercli= transcription method
- Use =sox= or =pythonstream= recording backend
- Audio stays 100% local

* License

MIT License - See LICENSE file

* For Developers

- [[file:docs/ARCHITECTURE.md][Architecture Documentation]]
- [[file:docs/API.md][API Documentation]]
- [[file:docs/TESTING.md][Testing Guide]]
- [[file:docs/CONTRIBUTING.md][Contributing]]
